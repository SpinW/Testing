# ward_s/spinw_testingUbuntu
# 
# Create an image with enough dependencies to support a mounted-in matlab.
#
# These expect you to define some local information:
# - `MATLAB_ROOT` is your matlab installation on the Docker host, perhaps `/usr/local/MATLAB/R2016a`.
# - `MATLAB_LOGS` is optional path on the Docker host to receive Matlab logs, perhaps `~/matlab-logs`.
# - `MATLAB_MAC_ADDRESS` is the MAC address associated with your own Matlab License, of the form `00:00:00:00:00:00`.
#
# Inspired from Mike Bartoli's docker-matlab code, https://github.com/mbartoli/docker-matlab.git 
#

FROM ubuntu:16.04

MAINTAINER Simon Ward <simon.ward@psi.ch>

RUN echo 'debconf debconf/frontend select Noninteractive' | debconf-set-selections

# Setup the graphics
# Replace 1000 with your user / group id
RUN export uid=1000 gid=1000 && \
    mkdir -p /home/developer && \
    echo "developer:x:${uid}:${gid}:Developer,,,:/home/developer:/bin/bash" >> /etc/passwd && \
    echo "developer:x:${uid}:" >> /etc/group && \
    chown ${uid}:${gid} -R /home/developer

# Matlab dependencies
RUN apt-get update && apt-get install -y \
    libpng12-dev libfreetype6-dev \
    libblas-dev liblapack-dev gfortran build-essential xorg git

USER developer
ENV HOME /home/developer

# Get SpinW and create startup file 
WORKDIR /home/developer
RUN git clone https://github.com/SpinW/spinw.git
RUN git clone https://github.com/SpinW/Testing.git

WORKDIR /home/developer/Testing

# run the container like a matlab executable 
ENV PATH="/usr/local/MATLAB/from-host/bin:${PATH}"
ENV MATLAB_JAVA="/usr/local/MATLAB/from-host/sys/java/jre/glnxa64/jre/"
ENTRYPOINT ["matlab", "-logfile /var/log/matlab/matlab.log -nosplash -nodesktop"]

